import mongoose from "mongoose";
import dotenv from "dotenv";
import User from "../models/User.js";
import Race from "../models/Race.js";
import Registration from "../models/Registrations.js";
import bcrypt from "bcryptjs";

// Cargar variables de entorno
dotenv.config();

// Función para obtener la URI de conexión correcta
function getMongoURI() {
  // Si se está ejecutando en Docker, usa el nombre de servicio "mongodb"
  // En local, usa localhost
  const baseURI = process.env.MONGODB_URI || "mongodb://localhost:27017/sports";

  // Reemplazar "mongodb" con "localhost" si se está ejecutando localmente
  return baseURI.replace("mongodb://mongodb:", "mongodb://localhost:");
}

// Función para hashear contraseñas
const hashPassword = async (password) => {
  const salt = await bcrypt.genSalt(10);
  return await bcrypt.hash(password, salt);
};


// Datos de ejemplo ampliados con 10 usuarios, 10 carreras y más inscripciones
const exampleData = {
  users: [
    {
      _id: new mongoose.Types.ObjectId("663f1b4667d0d8992e610c85"),
      email: "admin@example.com",
      name: "Admin Usuario",
      role: "admin",
      avatar: "default.jpg",
      age: 35,
      gender: "male",
      registrationDate: new Date("2026-01-15T10:30:00Z"),
    },
    {
      _id: new mongoose.Types.ObjectId("663f1b4667d0d8992e610c86"),
      email: "corredor@example.com",
      name: "Juan Corredor",
      role: "user",
      avatar: "default.jpg",
      age: 28,
      gender: "male",
      registrationDate: new Date("2026-02-20T14:45:00Z"),
    },
    {
      _id: new mongoose.Types.ObjectId("663f1b4667d0d8992e610c87"),
      email: "ciclista@example.com",
      name: "María Ciclista",
      role: "user",
      avatar: "default.jpg",
      age: 32,
      gender: "female",
      registrationDate: new Date("2026-03-05T09:15:00Z"),
    },
    {
      _id: new mongoose.Types.ObjectId("663f1b4667d0d8992e610c88"),
      email: "trailrunner@example.com",
      name: "Pedro Montaña",
      role: "user",
      avatar: "default.jpg",
      age: 29,
      gender: "male",
      registrationDate: new Date("2026-02-10T11:20:00Z"),
    },
    {
      _id: new mongoose.Types.ObjectId("663f1b4667d0d8992e610c89"),
      email: "ultra@example.com",
      name: "Sofia Ultra",
      role: "user",
      avatar: "default.jpg",
      age: 34,
      gender: "female",
      registrationDate: new Date("2026-01-25T08:40:00Z"),
    },
    {
      _id: new mongoose.Types.ObjectId("663f1b4667d0d8992e610c8a"),
      email: "triatleta@example.com",
      name: "Carlos Triatlón",
      role: "user",
      avatar: "default.jpg",
      age: 31,
      gender: "male",
      registrationDate: new Date("2026-03-12T16:30:00Z"),
    },
    {
      _id: new mongoose.Types.ObjectId("663f1b4667d0d8992e610c8b"),
      email: "amateur@example.com",
      name: "Laura Amateur",
      role: "user",
      avatar: "default.jpg",
      age: 26,
      gender: "female",
      registrationDate: new Date("2026-02-28T12:15:00Z"),
    },
    {
      _id: new mongoose.Types.ObjectId("663f1b4667d0d8992e610c8c"),
      email: "elite@example.com",
      name: "Marcos Elite",
      role: "user",
      avatar: "default.jpg",
      age: 30,
      gender: "male",
      registrationDate: new Date("2026-01-30T14:20:00Z"),
    },
    {
      _id: new mongoose.Types.ObjectId("663f1b4667d0d8992e610c8d"),
      email: "senior@example.com",
      name: "Elena Senior",
      role: "user",
      avatar: "default.jpg",
      age: 45,
      gender: "female",
      registrationDate: new Date("2026-03-08T10:45:00Z"),
    },
    {
      _id: new mongoose.Types.ObjectId("663f1b4667d0d8992e610c8e"),
      email: "organizador@example.com",
      name: "Roberto Organizador",
      role: "admin",
      avatar: "default.jpg",
      age: 40,
      gender: "male",
      registrationDate: new Date("2026-01-10T09:30:00Z"),
    },
  ],
  races: [
    {
      _id: new mongoose.Types.ObjectId("663f1b4667d0d8992e610d85"),
      name: "Maratón Urbano 2026",
      sport: "running",
      date: new Date("2026-05-15T08:00:00Z"),
      location: "Parque Central",
      distance: 42.2,
      maxParticipants: 500,
      unevenness: 150,
      tour: "ruta-maraton.gpx",
      qualifyingTime: "04:00:00",
      classification: [],
      createdBy: new mongoose.Types.ObjectId("663f1b4667d0d8992e610c85"),
      status: "open",
      createdAt: new Date("2026-01-10T11:30:00Z"),
      hasRunnersCSV: false,
      runnersCSVPath: null,
      lastCSVUpdate: null,
      hasGPXFile: true,
      gpxFilePath: "maraton-urbano.gpx",
      gpxFileUploadedAt: new Date("2026-01-11T14:30:00Z"),
      gpxFileName: "maraton-urbano.gpx",
    },
    {
      _id: new mongoose.Types.ObjectId("663f1b4667d0d8992e610d86"),
      name: "Trail de Montaña",
      sport: "trailRunning",
      date: new Date("2026-06-22T07:30:00Z"),
      location: "Sierra Norte",
      distance: 21.5,
      maxParticipants: 300,
      unevenness: 850,
      tour: "ruta-trail.gpx",
      qualifyingTime: "03:30:00",
      classification: [],
      createdBy: new mongoose.Types.ObjectId("663f1b4667d0d8992e610c85"),
      status: "open",
      createdAt: new Date("2026-02-15T10:45:00Z"),
      hasRunnersCSV: false,
      runnersCSVPath: null,
      lastCSVUpdate: null,
      hasGPXFile: true,
      gpxFilePath: "trail-montana.gpx",
      gpxFileUploadedAt: new Date("2026-02-16T09:20:00Z"),
      gpxFileName: "trail-montana.gpx",
    },
    {
      _id: new mongoose.Types.ObjectId("663f1b4667d0d8992e610d87"),
      name: "Gran Fondo Ciclista",
      sport: "cycling",
      date: new Date("2026-07-08T07:00:00Z"),
      location: "Valle del Río",
      distance: 120,
      maxParticipants: 400,
      unevenness: 1200,
      tour: "ruta-ciclista.gpx",
      qualifyingTime: "05:00:00",
      classification: [],
      createdBy: new mongoose.Types.ObjectId("663f1b4667d0d8992e610c85"),
      status: "open",
      createdAt: new Date("2026-03-10T09:20:00Z"),
      hasRunnersCSV: false,
      runnersCSVPath: null,
      lastCSVUpdate: null,
      hasGPXFile: true,
      gpxFilePath: "fondo-ciclista.gpx",
      gpxFileUploadedAt: new Date("2026-03-11T16:40:00Z"),
      gpxFileName: "fondo-ciclista.gpx",
    },
    {
      _id: new mongoose.Types.ObjectId("663f1b4667d0d8992e610d88"),
      name: "Media Maratón Nocturna",
      sport: "running",
      date: new Date("2026-08-10T20:00:00Z"),
      location: "Centro Histórico",
      distance: 21.1,
      maxParticipants: 450,
      unevenness: 100,
      tour: "ruta-nocturna.gpx",
      qualifyingTime: "02:30:00",
      classification: [
        { runner: "Marcos Elite", mark: "01:15:32" },
        { runner: "Pedro Montaña", mark: "01:18:45" },
        { runner: "Juan Corredor", mark: "01:21:10" },
      ],
      createdBy: new mongoose.Types.ObjectId("663f1b4667d0d8992e610c8e"),
      status: "finished",
      createdAt: new Date("2026-04-05T14:30:00Z"),
      hasRunnersCSV: true,
      runnersCSVPath: "media-maraton-resultados.csv",
      lastCSVUpdate: new Date("2026-08-11T09:15:00Z"),
      hasGPXFile: true,
      gpxFilePath: "media-maraton.gpx",
      gpxFileUploadedAt: new Date("2026-04-06T11:20:00Z"),
      gpxFileName: "media-maraton.gpx",
    },
    {
      _id: new mongoose.Types.ObjectId("663f1b4667d0d8992e610d89"),
      name: "Ultramaratón de Montaña",
      sport: "trailRunning",
      date: new Date("2026-09-05T06:00:00Z"),
      location: "Parque Natural",
      distance: 80,
      maxParticipants: 200,
      unevenness: 3200,
      tour: "ruta-ultra.gpx",
      qualifyingTime: "16:00:00",
      classification: [],
      createdBy: new mongoose.Types.ObjectId("663f1b4667d0d8992e610c85"),
      status: "closed",
      createdAt: new Date("2026-04-15T10:30:00Z"),
      hasRunnersCSV: false,
      runnersCSVPath: null,
      lastCSVUpdate: null,
      hasGPXFile: true,
      gpxFilePath: "ultra-montana.gpx",
      gpxFileUploadedAt: new Date("2026-04-16T14:50:00Z"),
      gpxFileName: "ultra-montana.gpx",
    },
    {
      _id: new mongoose.Types.ObjectId("663f1b4667d0d8992e610d8a"),
      name: "Criterium Ciclista",
      sport: "cycling",
      date: new Date("2026-10-12T09:30:00Z"),
      location: "Circuito Urbano",
      distance: 60,
      maxParticipants: 350,
      unevenness: 300,
      tour: "ruta-criterium.gpx",
      qualifyingTime: "02:30:00",
      classification: [
        { runner: "María Ciclista", mark: "01:45:22" },
        { runner: "Carlos Triatlón", mark: "01:48:35" },
      ],
      createdBy: new mongoose.Types.ObjectId("663f1b4667d0d8992e610c8e"),
      status: "finished",
      createdAt: new Date("2026-05-20T11:45:00Z"),
      hasRunnersCSV: true,
      runnersCSVPath: "criterium-resultados.csv",
      lastCSVUpdate: new Date("2026-10-13T12:30:00Z"),
      hasGPXFile: true,
      gpxFilePath: "criterium-ciclista.gpx",
      gpxFileUploadedAt: new Date("2026-05-21T09:10:00Z"),
      gpxFileName: "criterium-ciclista.gpx",
    },
    {
      _id: new mongoose.Types.ObjectId("663f1b4667d0d8992e610d8b"),
      name: "10K Parque Metropolitano",
      sport: "running",
      date: new Date("2026-11-08T08:30:00Z"),
      location: "Parque Metropolitano",
      distance: 10,
      maxParticipants: 600,
      unevenness: 50,
      tour: "ruta-10k.gpx",
      qualifyingTime: "01:00:00",
      classification: [],
      createdBy: new mongoose.Types.ObjectId("663f1b4667d0d8992e610c85"),
      status: "open",
      createdAt: new Date("2026-06-10T15:30:00Z"),
      hasRunnersCSV: false,
      runnersCSVPath: null,
      lastCSVUpdate: null,
      hasGPXFile: false,
      gpxFilePath: null,
      gpxFileUploadedAt: null,
      gpxFileName: null,
    },
    {
      _id: new mongoose.Types.ObjectId("663f1b4667d0d8992e610d8c"),
      name: "Trail Corto Primavera",
      sport: "trailRunning",
      date: new Date("2026-04-12T09:00:00Z"),
      location: "Bosque del Este",
      distance: 15,
      maxParticipants: 250,
      unevenness: 450,
      tour: "ruta-trail-corto.gpx",
      qualifyingTime: "02:00:00",
      classification: [],
      createdBy: new mongoose.Types.ObjectId("663f1b4667d0d8992e610c8e"),
      status: "cancelled",
      createdAt: new Date("2026-01-25T13:45:00Z"),
      hasRunnersCSV: false,
      runnersCSVPath: null,
      lastCSVUpdate: null,
      hasGPXFile: true,
      gpxFilePath: "trail-corto.gpx",
      gpxFileUploadedAt: new Date("2026-01-26T10:30:00Z"),
      gpxFileName: "trail-corto.gpx",
    },
    {
      _id: new mongoose.Types.ObjectId("663f1b4667d0d8992e610d8d"),
      name: "Ruta Ciclista de Otoño",
      sport: "cycling",
      date: new Date("2026-10-25T08:00:00Z"),
      location: "Valle del Norte",
      distance: 90,
      maxParticipants: 300,
      unevenness: 950,
      tour: "ruta-otono.gpx",
      qualifyingTime: "04:00:00",
      classification: [],
      createdBy: new mongoose.Types.ObjectId("663f1b4667d0d8992e610c85"),
      status: "deleted",
      createdAt: new Date("2026-05-30T11:15:00Z"),
      hasRunnersCSV: false,
      runnersCSVPath: null,
      lastCSVUpdate: null,
      hasGPXFile: false,
      gpxFilePath: null,
      gpxFileUploadedAt: null,
      gpxFileName: null,
    },
    {
      _id: new mongoose.Types.ObjectId("663f1b4667d0d8992e610d8e"),
      name: "5K Solidario",
      sport: "running",
      date: new Date("2026-12-20T10:00:00Z"),
      location: "Avenida Principal",
      distance: 5,
      maxParticipants: 800,
      unevenness: 20,
      tour: "ruta-5k.gpx",
      qualifyingTime: "00:30:00",
      classification: [],
      createdBy: new mongoose.Types.ObjectId("663f1b4667d0d8992e610c8e"),
      status: "open",
      createdAt: new Date("2026-07-15T14:20:00Z"),
      hasRunnersCSV: false,
      runnersCSVPath: null,
      lastCSVUpdate: null,
      hasGPXFile: true,
      gpxFilePath: "5k-solidario.gpx",
      gpxFileUploadedAt: new Date("2026-07-16T09:45:00Z"),
      gpxFileName: "5k-solidario.gpx",
    },
  ],
  registrations: [
    // Inscripciones originales
    {
      _id: new mongoose.Types.ObjectId("663f1b4667d0d8992e610e85"),
      race: new mongoose.Types.ObjectId("663f1b4667d0d8992e610d85"),
      user: new mongoose.Types.ObjectId("663f1b4667d0d8992e610c86"),
      dorsal: 101,
      registeredAt: new Date("2026-03-15T14:30:00Z"),
      status: "registered",
      time: null,
      position: null,
      hasUserGpx: false,
      userGpxPath: null,
      userGpxUploadedAt: null,
      userGpxFileName: null,
      userGpxData: {
        totalDistance: null,
        elevationGain: null,
        elevationLoss: null,
        movingTime: null,
        totalTime: null,
        avgSpeed: null,
        maxSpeed: null,
      },
    },
    {
      _id: new mongoose.Types.ObjectId("663f1b4667d0d8992e610e86"),
      race: new mongoose.Types.ObjectId("663f1b4667d0d8992e610d86"),
      user: new mongoose.Types.ObjectId("663f1b4667d0d8992e610c86"),
      dorsal: 202,
      registeredAt: new Date("2026-03-16T10:45:00Z"),
      status: "registered",
      time: null,
      position: null,
      hasUserGpx: false,
      userGpxPath: null,
      userGpxUploadedAt: null,
      userGpxFileName: null,
      userGpxData: {
        totalDistance: null,
        elevationGain: null,
        elevationLoss: null,
        movingTime: null,
        totalTime: null,
        avgSpeed: null,
        maxSpeed: null,
      },
    },
    {
      _id: new mongoose.Types.ObjectId("663f1b4667d0d8992e610e87"),
      race: new mongoose.Types.ObjectId("663f1b4667d0d8992e610d87"),
      user: new mongoose.Types.ObjectId("663f1b4667d0d8992e610c87"),
      dorsal: 303,
      registeredAt: new Date("2026-03-20T11:15:00Z"),
      status: "registered",
      time: null,
      position: null,
      hasUserGpx: false,
      userGpxPath: null,
      userGpxUploadedAt: null,
      userGpxFileName: null,
      userGpxData: {
        totalDistance: null,
        elevationGain: null,
        elevationLoss: null,
        movingTime: null,
        totalTime: null,
        avgSpeed: null,
        maxSpeed: null,
      },
    },
    // Nuevas inscripciones
    {
      _id: new mongoose.Types.ObjectId("663f1b4667d0d8992e610e88"),
      race: new mongoose.Types.ObjectId("663f1b4667d0d8992e610d88"),
      user: new mongoose.Types.ObjectId("663f1b4667d0d8992e610c8c"),
      dorsal: 42,
      registeredAt: new Date("2026-05-20T09:30:00Z"),
      status: "finished",
      time: "01:15:32",
      position: 1,
      hasUserGpx: true,
      userGpxPath: "user_marcos_media_maraton.gpx",
      userGpxUploadedAt: new Date("2026-08-10T22:45:00Z"),
      userGpxFileName: "marcos_elite_media_maraton.gpx",
      userGpxData: {
        totalDistance: 21.3,
        elevationGain: 112,
        elevationLoss: 112,
        movingTime: "01:14:30",
        totalTime: "01:15:32",
        avgSpeed: 16.9,
        maxSpeed: 19.8,
      },
    },
    {
      _id: new mongoose.Types.ObjectId("663f1b4667d0d8992e610e89"),
      race: new mongoose.Types.ObjectId("663f1b4667d0d8992e610d88"),
      user: new mongoose.Types.ObjectId("663f1b4667d0d8992e610c88"),
      dorsal: 57,
      registeredAt: new Date("2026-05-18T14:15:00Z"),
      status: "finished",
      time: "01:18:45",
      position: 2,
      hasUserGpx: true,
      userGpxPath: "user_pedro_media_maraton.gpx",
      userGpxUploadedAt: new Date("2026-08-10T22:50:00Z"),
      userGpxFileName: "pedro_montana_media_maraton.gpx",
      userGpxData: {
        totalDistance: 21.2,
        elevationGain: 105,
        elevationLoss: 105,
        movingTime: "01:17:30",
        totalTime: "01:18:45",
        avgSpeed: 16.1,
        maxSpeed: 18.5,
      },
    },
    {
      _id: new mongoose.Types.ObjectId("663f1b4667d0d8992e610e8a"),
      race: new mongoose.Types.ObjectId("663f1b4667d0d8992e610d88"),
      user: new mongoose.Types.ObjectId("663f1b4667d0d8992e610c86"),
      dorsal: 63,
      registeredAt: new Date("2026-05-22T11:40:00Z"),
      status: "finished",
      time: "01:21:10",
      position: 3,
      hasUserGpx: true,
      userGpxPath: "user_juan_media_maraton.gpx",
      userGpxUploadedAt: new Date("2026-08-10T23:05:00Z"),
      userGpxFileName: "juan_corredor_media_maraton.gpx",
      userGpxData: {
        totalDistance: 21.1,
        elevationGain: 98,
        elevationLoss: 98,
        movingTime: "01:20:45",
        totalTime: "01:21:10",
        avgSpeed: 15.6,
        maxSpeed: 17.2,
      },
    },
    {
      _id: new mongoose.Types.ObjectId("663f1b4667d0d8992e610e8b"),
      race: new mongoose.Types.ObjectId("663f1b4667d0d8992e610d8a"),
      user: new mongoose.Types.ObjectId("663f1b4667d0d8992e610c87"),
      dorsal: 25,
      registeredAt: new Date("2026-07-05T10:30:00Z"),
      status: "finished",
      time: "01:45:22",
      position: 1,
      hasUserGpx: true,
      userGpxPath: "user_maria_criterium.gpx",
      userGpxUploadedAt: new Date("2026-10-12T13:20:00Z"),
      userGpxFileName: "maria_ciclista_criterium.gpx",
      userGpxData: {
        totalDistance: 60.5,
        elevationGain: 315,
        elevationLoss: 315,
        movingTime: "01:44:50",
        totalTime: "01:45:22",
        avgSpeed: 34.2,
        maxSpeed: 48.7,
      },
    },
    {
      _id: new mongoose.Types.ObjectId("663f1b4667d0d8992e610e8c"),
      race: new mongoose.Types.ObjectId("663f1b4667d0d8992e610d8a"),
      user: new mongoose.Types.ObjectId("663f1b4667d0d8992e610c8a"),
      dorsal: 31,
      registeredAt: new Date("2026-07-10T16:45:00Z"),
      status: "finished",
      time: "01:48:35",
      position: 2,
      hasUserGpx: true,
      userGpxPath: "user_carlos_criterium.gpx",
      userGpxUploadedAt: new Date("2026-10-12T13:35:00Z"),
      userGpxFileName: "carlos_triatlon_criterium.gpx",
      userGpxData: {
        totalDistance: 60.2,
        elevationGain: 305,
        elevationLoss: 305,
        movingTime: "01:47:55",
        totalTime: "01:48:35",
        avgSpeed: 33.1,
        maxSpeed: 46.3,
      },
    },
    {
      _id: new mongoose.Types.ObjectId("663f1b4667d0d8992e610e8d"),
      race: new mongoose.Types.ObjectId("663f1b4667d0d8992e610d85"),
      user: new mongoose.Types.ObjectId("663f1b4667d0d8992e610c88"),
      dorsal: 125,
      registeredAt: new Date("2026-03-18T09:45:00Z"),
      status: "registered",
      time: null,
      position: null,
      hasUserGpx: false,
      userGpxPath: null,
      userGpxUploadedAt: null,
      userGpxFileName: null,
      userGpxData: {
        totalDistance: null,
        elevationGain: null,
        elevationLoss: null,
        movingTime: null,
        totalTime: null,
        avgSpeed: null,
        maxSpeed: null,
      },
    },
    {
      _id: new mongoose.Types.ObjectId("663f1b4667d0d8992e610e8e"),
      race: new mongoose.Types.ObjectId("663f1b4667d0d8992e610d85"),
      user: new mongoose.Types.ObjectId("663f1b4667d0d8992e610c8c"),
      dorsal: 135,
      registeredAt: new Date("2026-03-20T15:30:00Z"),
      status: "registered",
      time: null,
      position: null,
      hasUserGpx: false,
      userGpxPath: null,
      userGpxUploadedAt: null,
      userGpxFileName: null,
      userGpxData: {
        totalDistance: null,
        elevationGain: null,
        elevationLoss: null,
        movingTime: null,
        totalTime: null,
        avgSpeed: null,
        maxSpeed: null,
      },
    },
    {
      _id: new mongoose.Types.ObjectId("663f1b4667d0d8992e610e8f"),
      race: new mongoose.Types.ObjectId("663f1b4667d0d8992e610d85"),
      user: new mongoose.Types.ObjectId("663f1b4667d0d8992e610c8b"),
      dorsal: 142,
      registeredAt: new Date("2026-03-22T10:15:00Z"),
      status: "registered",
      time: null,
      position: null,
      hasUserGpx: false,
      userGpxPath: null,
      userGpxUploadedAt: null,
      userGpxFileName: null,
      userGpxData: {
        totalDistance: null,
        elevationGain: null,
        elevationLoss: null,
        movingTime: null,
        totalTime: null,
        avgSpeed: null,
        maxSpeed: null,
      },
    },
    {
      _id: new mongoose.Types.ObjectId("663f1b4667d0d8992e610e90"),
      race: new mongoose.Types.ObjectId("663f1b4667d0d8992e610d87"),
      user: new mongoose.Types.ObjectId("663f1b4667d0d8992e610c8a"),
      dorsal: 315,
      registeredAt: new Date("2026-03-25T14:50:00Z"),
      status: "registered",
      time: null,
      position: null,
      hasUserGpx: false,
      userGpxPath: null,
      userGpxUploadedAt: null,
      userGpxFileName: null,
      userGpxData: {
        totalDistance: null,
        elevationGain: null,
        elevationLoss: null,
        movingTime: null,
        totalTime: null,
        avgSpeed: null,
        maxSpeed: null,
      },
    },
    {
      _id: new mongoose.Types.ObjectId("663f1b4667d0d8992e610e91"),
      race: new mongoose.Types.ObjectId("663f1b4667d0d8992e610d87"),
      user: new mongoose.Types.ObjectId("663f1b4667d0d8992e610c8d"),
      dorsal: 328,
      registeredAt: new Date("2026-04-02T11:30:00Z"),
      status: "registered",
      time: null,
      position: null,
      hasUserGpx: false,
      userGpxPath: null,
      userGpxUploadedAt: null,
      userGpxFileName: null,
      userGpxData: {
        totalDistance: null,
        elevationGain: null,
        elevationLoss: null,
        movingTime: null,
        totalTime: null,
        avgSpeed: null,
        maxSpeed: null,
      },
    },
    {
      _id: new mongoose.Types.ObjectId("663f1b4667d0d8992e610e92"),
      race: new mongoose.Types.ObjectId("663f1b4667d0d8992e610d86"),
      user: new mongoose.Types.ObjectId("663f1b4667d0d8992e610c89"),
      dorsal: 215,
      registeredAt: new Date("2026-03-28T09:15:00Z"),
      status: "registered",
      time: null,
      position: null,
      hasUserGpx: false,
      userGpxPath: null,
      userGpxUploadedAt: null,
      userGpxFileName: null,
      userGpxData: {
        totalDistance: null,
        elevationGain: null,
        elevationLoss: null,
        movingTime: null,
        totalTime: null,
        avgSpeed: null,
        maxSpeed: null,
      },
    },
    {
      _id: new mongoose.Types.ObjectId("663f1b4667d0d8992e610e93"),
      race: new mongoose.Types.ObjectId("663f1b4667d0d8992e610d89"),
      user: new mongoose.Types.ObjectId("663f1b4667d0d8992e610c89"),
      dorsal: 42,
      registeredAt: new Date("2026-06-10T14:30:00Z"),
      status: "registered",
      time: null,
      position: null,
      hasUserGpx: false,
      userGpxPath: null,
      userGpxUploadedAt: null,
      userGpxFileName: null,
      userGpxData: {
        totalDistance: null,
        elevationGain: null,
        elevationLoss: null,
        movingTime: null,
        totalTime: null,
        avgSpeed: null,
        maxSpeed: null,
      },
    },
    {
      _id: new mongoose.Types.ObjectId("663f1b4667d0d8992e610e94"),
      race: new mongoose.Types.ObjectId("663f1b4667d0d8992e610d89"),
      user: new mongoose.Types.ObjectId("663f1b4667d0d8992e610c88"),
      dorsal: 57,
      registeredAt: new Date("2026-06-12T11:20:00Z"),
      status: "registered",
      time: null,
      position: null,
      hasUserGpx: false,
      userGpxPath: null,
      userGpxUploadedAt: null,
      userGpxFileName: null,
      userGpxData: {
        totalDistance: null,
        elevationGain: null,
        elevationLoss: null,
        movingTime: null,
        totalTime: null,
        avgSpeed: null,
        maxSpeed: null,
      },
    },
    {
      _id: new mongoose.Types.ObjectId("663f1b4667d0d8992e610e95"),
      race: new mongoose.Types.ObjectId("663f1b4667d0d8992e610d8e"),
      user: new mongoose.Types.ObjectId("663f1b4667d0d8992e610c8b"),
      dorsal: 105,
      registeredAt: new Date("2026-08-15T13:45:00Z"),
      status: "registered",
      time: null,
      position: null,
      hasUserGpx: false,
      userGpxPath: null,
      userGpxUploadedAt: null,
      userGpxFileName: null,
      userGpxData: {
        totalDistance: null,
        elevationGain: null,
        elevationLoss: null,
        movingTime: null,
        totalTime: null,
        avgSpeed: null,
        maxSpeed: null,
      },
    },
    {
      _id: new mongoose.Types.ObjectId("663f1b4667d0d8992e610e96"),
      race: new mongoose.Types.ObjectId("663f1b4667d0d8992e610d8e"),
      user: new mongoose.Types.ObjectId("663f1b4667d0d8992e610c8d"),
      dorsal: 110,
      registeredAt: new Date("2026-08-18T10:30:00Z"),
      status: "registered",
      time: null,
      position: null,
      hasUserGpx: false,
      userGpxPath: null,
      userGpxUploadedAt: null,
      userGpxFileName: null,
      userGpxData: {
        totalDistance: null,
        elevationGain: null,
        elevationLoss: null,
        movingTime: null,
        totalTime: null,
        avgSpeed: null,
        maxSpeed: null,
      },
    },
    {
      _id: new mongoose.Types.ObjectId("663f1b4667d0d8992e610e97"),
      race: new mongoose.Types.ObjectId("663f1b4667d0d8992e610d8b"),
      user: new mongoose.Types.ObjectId("663f1b4667d0d8992e610c86"),
      dorsal: 87,
      registeredAt: new Date("2026-07-25T16:40:00Z"),
      status: "registered",
      time: null,
      position: null,
      hasUserGpx: false,
      userGpxPath: null,
      userGpxUploadedAt: null,
      userGpxFileName: null,
      userGpxData: {
        totalDistance: null,
        elevationGain: null,
        elevationLoss: null,
        movingTime: null,
        totalTime: null,
        avgSpeed: null,
        maxSpeed: null,
      },
    },
    {
      _id: new mongoose.Types.ObjectId("663f1b4667d0d8992e610e98"),
      race: new mongoose.Types.ObjectId("663f1b4667d0d8992e610d8b"),
      user: new mongoose.Types.ObjectId("663f1b4667d0d8992e610c8c"),
      dorsal: 92,
      registeredAt: new Date("2026-07-28T11:15:00Z"),
      status: "registered",
      time: null,
      position: null,
      hasUserGpx: false,
      userGpxPath: null,
      userGpxUploadedAt: null,
      userGpxFileName: null,
      userGpxData: {
        totalDistance: null,
        elevationGain: null,
        elevationLoss: null,
        movingTime: null,
        totalTime: null,
        avgSpeed: null,
        maxSpeed: null,
      },
    },
    {
      _id: new mongoose.Types.ObjectId("663f1b4667d0d8992e610e99"),
      race: new mongoose.Types.ObjectId("663f1b4667d0d8992e610d8c"),
      user: new mongoose.Types.ObjectId("663f1b4667d0d8992e610c88"),
      dorsal: 25,
      registeredAt: new Date("2026-02-15T10:30:00Z"),
      status: "cancelled",
      time: null,
      position: null,
      hasUserGpx: false,
      userGpxPath: null,
      userGpxUploadedAt: null,
      userGpxFileName: null,
      userGpxData: {
        totalDistance: null,
        elevationGain: null,
        elevationLoss: null,
        movingTime: null,
        totalTime: null,
        avgSpeed: null,
        maxSpeed: null,
      },
    },
  ],
}


// Función para seedear la base de datos
async function seedDatabase() {
  try {
    const mongoURI = getMongoURI();
    console.log("Conectando a:", mongoURI);

    await mongoose.connect(mongoURI, {
      socketTimeoutMS: 45000,
      serverSelectionTimeoutMS: 45000,
    });
    console.log("Conexión a MongoDB establecida");

    await User.deleteMany({});
    await Race.deleteMany({});
    await Registration.deleteMany({});

    console.log("Colecciones limpiadas");

    // Hashear todas las contraseñas con bcrypt
    const hashedUsers = await Promise.all(
      exampleData.users.map(async (user) => {
        const hashedPassword = await hashPassword("123456");
        return { ...user, password: hashedPassword };
      })
    );

    await User.insertMany(hashedUsers);
    console.log("Usuarios insertados con contraseñas hasheadas");

    await Race.insertMany(exampleData.races);
    console.log("Carreras insertadas");

    await Registration.insertMany(exampleData.registrations);
    console.log("Inscripciones insertadas");

    console.log("Base de datos inicializada correctamente");
  } catch (error) {
    console.error("Error al seedear la base de datos:", error);
  } finally {
    await mongoose.connection.close();
  }
}

// Ejecutar la función de seedeo
seedDatabase();